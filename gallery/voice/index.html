<html lang="ja" xml:lang="ja">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="pragma" content="no-cache">
        <meta http-equiv="cache-control" content="no-cache">
        <meta http-equiv="expires" content="-1">
        <meta name="format-detection" content="telephone=no">
        <title>アイドルマスター シンデレラガールズ</title>
        <link rel="stylesheet" type="text/css" href="../../idolmaster/css/rich/new_mypage_common.css" media="all">
        <script type="text/javascript">if(window.localStorage){var displaySet=localStorage.getItem('DisplayPositionSet');if(displaySet==1){if(navigator.userAgent.indexOf('Android')>0){document.write('<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">');document.getElementsByTagName('html')[0].style.zoom=document.documentElement.clientWidth/320;}else{document.write('<meta name="viewport" content="width=320, user-scalable=no">');}window.addEventListener('resize',function(){if(navigator.userAgent.indexOf('Android')>0)document.getElementsByTagName('html')[0].style.zoom=document.documentElement.clientWidth/320;});}else{document.write('<meta name="viewport" content="width=device-width, user-scalable=no">');}}else{document.write('<meta name="viewport" content="width=device-width, user-scalable=no">');}</script>
        <script src="../../idolmaster/js/jquery-1.9.1.min.js" type="text/javascript"></script>
        <script src="../../idolmaster/js/underscore-min.js"></script>
        <script>
            (function () {
                var _path = location.href;
                var _spec_obj;
                var _spec = 'none';
                var version = 1;
                // access方法検出
                _spec_obj = {
                    'isNative': false,
                    'isAndApp': false,
                    'isShellApp': false,
                    'isIosApp': false,
                    'isChromeApp': false
                };
                window._spec = _spec_obj;
                if (_spec.isAndApp) {
                    _spec = 'andapp'
                } else if (_spec.isIosApp) {
                    _spec = 'iosApp';
                } else if (_spec.isShellApp) {
                    _spec = 'shellapp';
                } else {
                    _spec = 'browser?';
                }
            })();
        </script>
        <script src="../../idolmaster/js/require.js"></script>
        <script>
            requirejs.config({
                paths: {
                    easeljs: "../../idolmaster/js/easeljs-0.8.2.min.js",
                    easeljs_0_7_1: "../../idolmaster/js/easeljs-0.7.1.min.js", 
                    tweenjs: "../../idolmaster/js/tweenjs-0.6.2.min.js",
                    movieclipjs: "../../idolmaster/js/movieclip-0.7.1.min.js",
                    createjs: "../../idolmaster/js/createjs-2015.11.26.min.js",
                }
            })
        </script>
        <script src="../../idolmaster/js/jquery.flexslider.js" type="text/javascript"></script>
        <script src="../../idolmaster/js/common.js" type="text/javascript"></script>
        <script src="../../idolmaster/js/common_new.js" type="text/javascript"></script>
        <script src="../../idolmaster/js/banner.js" type="text/javascript"></script>
        <script type="text/javascript">var se_flg = 0, bgm_flg = 0, chrome_app_flg = 0, chrome_app_extension_id = 'dnacabmnfmejgfffmcehejcmiciinpej';</script>
        <script type="text/javascript" src="../../idolmaster/js/app_sound.js"></script>
        <link rel="stylesheet" type="text/css" href="../../idolmaster/css/base.css?20171116">
    </head>
    <body id="idol_story">
        <div id="pageArea" onunload="unloadBye()">
            <div id="top" class="page_container jsOnBtn">
                <nav class="area_menu_header">
                    <div class="area_menu_header_6btn">
                        <h1 id="JtextLimit">思い出エピソード</h1>
                        <ul>
                            <li>
                                <a class="head_menu_01 disabled">
                                    <div></div>
                                </a>
                            </li>
                            <li>
                                <a class="head_menu_02 disabled">
                                    <div></div>
                                </a>
                            </li>
                            <li>
                                <a class="head_menu_03 disabled">
                                    <div></div>
                                </a>
                            </li>
                            <li>
                                <a class="head_menu_04 disabled" >
                                    <div></div>
                                </a>
                            </li>
                            <li>
                                <a class="head_menu_05 disabled">
                                    <div></div>
                                </a>
                            </li>
                            <li>
                                <a class="head_menu_06 se_000 disabled" href="#" id="headerAcd">
                                    <div></div>
                                </a>
                            </li>
                        </ul>
                    </div>
                </nav>
                <style>
                    .gacha_title:before{ background:url('../../idolmaster/image_sp/gacha/gacha_title.jpg') no-repeat; background-size:320px 110px; width:320px; height: 52px; content:''; display:block; }
                    .gacha_title:after{ background:url('../../idolmaster/image_sp/gacha/gacha_title.jpg') 0 -80px no-repeat; background-size:320px 110px; width: 320px; height: 25px; content:''; display:block; }
                    .gacha_title div{ margin: -7px 0 -2px;}
                    .gacha_title{ background-color: #000b1f; text-align:center; font-size:16px; line-height:120%;}
                </style>
                <h2 id="gacha_title" class="gacha_title">
                </h2>
                <h3 id="title_hanyo" class="title_hanyo">
                </h3>
                <div class="card_rotate" style="height:400px; z-index:10; margin-bottom:10px;">
                    <div class="cardSize_l">
                        <div class="card_img">
                            <style type='text/css'>
                                .rotate_appear{
                                -webkit-animation-name: anime1b;
                                -webkit-animation-duration: 200ms;
                                -webkit-animation-timing-function: ease-out;
                                -webkit-animation-fill-mode: forwards;
                                }
                                .rotate_disappear{
                                -webkit-animation-name: anime1;
                                -webkit-animation-duration: 200ms;
                                -webkit-animation-timing-function: ease-out;
                                -webkit-animation-fill-mode: forwards;
                                }
                                @-webkit-keyframes anime1{
                                from{
                                -webkit-transform: scale(1, 1);
                                transform: scale(1, 1);
                                }
                                50%{
                                -webkit-transform: scale(0.5, 1);
                                transform: scale(0.5, 1);
                                }
                                to{
                                -webkit-transform: scale(0, 1);
                                transform: scale(0, 1);
                                }
                                }
                                @-webkit-keyframes anime1b{
                                from{
                                -webkit-transform: scale(0, 1);
                                transform: scale(0, 1);
                                }
                                50%{
                                -webkit-transform: scale(0.5, 1);
                                transform: scale(0.5, 1);
                                }
                                to{
                                -webkit-transform: scale(1, 1);
                                transform: scale(1, 1);
                                }
                                }
                                .card_rotate{
                                -webkit-user-select: none;
                                -webkit-tap-highlight-color:rgba(0,0,0,0);
                                }
                                .card_img{
                                position:absolute;
                                }
                            </style>
                            <script src='../../idolmaster/js/rotate.js' type='text/javascript'></script>
                        </div>
                        <div class="mask01 cardFrame01">
                            <div class="mask02 cardFrame02"></div>
                        </div>
                    </div>
                </div>
                <div class="fukidashi m-Btm10">
                    <img src="../../idolmaster/image_sp/ui/line_quest_hukidasi_up.jpg" width="100%"><br>
                    <div id="comment_container" style="height:4em;text-decoration:none;display:table-cell;vertical-align:middle;">
                    </div>
                    <img src="../../idolmaster/image_sp/ui/line_quest_hukidasi_down.jpg" width="100%"><br>
                </div>
                <div class="m-Btm5" style="display:-webkit-box; width:100%;">
                    <div style="width:100px; text-align:right;">
                        <img src="../../idolmaster/image_sp/ui/episode/epi_button_voicetext_prev.jpg" width="57" id="moveLeft"><br>
                    </div>
                    <div id="pager" style="width:120px; text-align:center; line-height:31px; font-size:16px;">
                    </div>
                    <div style="width:100px; text-align:left;">
                        <img src="../../idolmaster/image_sp/ui/episode/epi_button_voicetext_next.jpg" width="57" id="moveRight"><br>
                    </div>
                </div>
                <img src="../../idolmaster/image_sp/ui/line_hanyo_ten.jpg" width="100%" class="m-Btm10"><br>
                <div style="text-align:center;">
                    <a href="#" class="voicePlay" style="visibility:hidden;">
                    <img src="../../idolmaster/image_sp/ui/episode/epi_button_voice_open.jpg" width="300" height="50"></a>
                    <img src="../../idolmaster/image_sp/ui/episode/epi_button_voice_open.jpg" width="300" height="50" style="display:none;">
                    <img src="../../idolmaster/image_sp/ui/episode/epi_button_voice_loading.jpg" width="300" height="50" style="display:none;">
                    <img src="../../idolmaster/image_sp/ui/episode/epi_button_voice_playing.jpg" width="300" height="50" style="display:none;">
                </div>
                <div id="duration" class="t-Cnt m-Btm12">
                </div>
                <a href="javascript:history.back();">
                    <div class="backLink">戻る</div>
                </a>
                <script src="../../idolmaster/js/boombox.min.js"></script>
                <script type="text/javascript">
                    $(function () {
                        var ua = navigator.userAgent;
                        if ((ua.indexOf('iPhone') > -1 || ua.indexOf('iPod') > -1 || ua.indexOf('iPad') > -1 || ua.indexOf('Android') > -1) && 'ontouchstart' in window) {
                            var start = "touchstart";
                            var end = "touchend";
                        } else {
                            var start = "mousedown";
                            var end = "mouseup";
                        }
                        
                        var searchParams = new URLSearchParams(window.location.search);
                        var detail_path = searchParams.get("detail_path");
                        if (!detail_path) {
                            alert("Bad URL!");
                            window.location = "../";
                            return;
                        }
                        
                        var req = new XMLHttpRequest();
                        req.open('GET', detail_path, false);
                        req.send();
                        
                        var voice_data = JSON.parse(req.response);
                        
                        var gachaTitle = document.getElementById("gacha_title");
                        gachaTitle.innerHTML = voice_data.title;
                        
                        var hanyoTitle = document.getElementById("title_hanyo");
                        hanyoTitle.innerHTML = voice_data.card_name;
                        
                        var duration = document.getElementById("duration");
                        duration.innerHTML = voice_data.duration;
                        
                        var cardImgContainer = document.getElementsByClassName("card_img")[0];
                        
                        var elem_card_img = document.createElement('div');
                        elem_card_img.classList.add("rotate_img", "js_current");
                        elem_card_img.style = "position:relative; background-image:url(" + voice_data.card_img + "); height:400px; text-align: -webkit-match-parent;";
                        elem_card_img.setAttribute("twinkle", "0");
                        elem_card_img.setAttribute("key", "");
                        
                        cardImgContainer.appendChild(elem_card_img);
                        
                        if (voice_data.card_img_nf) {
                            elem_card_img.classList.add("window_on", "r_on");
                            
                            var elem_card_img_nf = document.createElement('div');
                            elem_card_img_nf.classList.add("rotate_img", "js_current");
                            elem_card_img_nf.style = "position:relative; background-image:url(" + voice_data.card_img_nf + "); height:400px; text-align: -webkit-match-parent;";
                            elem_card_img_nf.setAttribute("twinkle", "0");
                            elem_card_img_nf.setAttribute("key", "");
                            
                            cardImgContainer.appendChild(elem_card_img_nf);
                        }
                        
                        var commentContainer = document.getElementById("comment_container");
                        for (var i = 0; i < voice_data.comments.length; i++) {
                            elem_comment = document.createElement('p');
                            elem_comment.classList.add("comment_" + (i+1));
                            elem_comment.style = "display:none; line-height:120%;";
                            elem_comment.innerText = voice_data.comments[i];
                            
                            commentContainer.appendChild(elem_comment);
                        }
                        
                        var pager = document.getElementById("pager");
                        pager.innerHTML = '<span id="nowNum">1</span> / ' + voice_data.comments.length;
                        
                        var index = 1;
                        var maxCount = voice_data.comments.length;
                        
                        $('p.comment_' + index).show();
                        $('#nowNum').html(index);
                        $('#moveLeft').css('opacity', '0.5');
                        $('#moveLeft').on(end, function () {
                            var index = $('#nowNum').html();
                            $('#moveRight').css('opacity', '1');
                            if (index > 1) {
                                $('p.comment_' + index).hide();
                                index--;
                                $('p.comment_' + index).show();
                                $('#nowNum').html(index);
                                if (index == 1) {
                                    $('#moveLeft').css('opacity', '0.5');
                                }
                            }
                        });
                        
                        $('#moveRight').on(end, function () {
                            var index = $('#nowNum').html();
                            $('#moveLeft').css('opacity', '1');
                            if (index < maxCount) {
                                $('p.comment_' + index).hide();
                                index++;
                                $('p.comment_' + index).show();
                                $('#nowNum').html(index);
                                if (index == maxCount) {
                                    $('#moveRight').css('opacity', '0.5');
                                }
                            }
                        });
                        var pattern = /Android [0-4]/;
                        window.ios = ua.match(/os [0-9]/);
                        window.ready = (ios) ? false : true;
                        timer = false;
                        playing = false;
                        var And = null;
                        if (ua.match(pattern))
                            And = true;
                        var weba = {
                            webaudio: {
                                use: false
                            }
                        };
                        boombox.setup(And ? weba : null);
                        window.htc = ua.indexOf('ISW13HT') > -1;
                        if (!boombox.isWebAudio() && !boombox.isHTMLAudio() && boombox.isHTMLVideo())
                            window.htc = true;
                        var VoiceSwitch = null;
                        window.playIndex = 0;
                        if (window.localStorage) {
                            VoiceSwitch = localStorage.getItem('IdolVoiceAdmitSwitch');
                        }
                        if (VoiceSwitch != 'OFF') {
                            var voiceSource = voice_data.voice_path;
                            voiceDataAry = voiceSource.split(',');
                            if (ios) {
                                $('a.voicePlay img').attr('src', '../../idolmaster/image_sp/ui/episode/epi_button_voice_loading.jpg');
                                voiceReady(playIndex, voiceDataAry[playIndex].replace(/\"/g, ''));
                            }
                            $('a.voicePlay').css('visibility', 'visible');
                            $('a.voicePlay').click(function () {
                                if (!window.ready)
                                    return false;
                                var cached = boombox.get('story_' + playIndex);
                                if (cached == void 0) {
                                    $('a.voicePlay img').attr('src', '../../idolmaster/image_sp/ui/episode/epi_button_voice_loading.jpg');
                                    voiceReady(playIndex, voiceDataAry[playIndex].replace(/\"/g, ''));
                                } else {
                                    if (cached.state.time.pause == void 0 && cached.state.time.playback == void 0 && cached.state.time.progress == 0 || !ios && !playing) {
                                        $('a.voicePlay img').attr('src', '../../idolmaster/image_sp/ui/episode/epi_button_voice_playing.jpg');
                                        cached.play();
                                        playing = true;
                                    } else if (cached.state.time.pause == void 0) {
                                        pause(cached);
                                    } else {
                                        resume(cached);
                                    }
                                }
                                return false;
                            });
                            boombox.onVisibilityChange = function () {}
                            if (ua.indexOf('ChromeApp') > -1 || !('ontouchstart' in window)) {
                                boombox.onFocus = function () {}
                                boombox.onBlur = function () {}
                            } else {
                                boombox.onBlur = function () {
                                    var cached = boombox.get('story_' + playIndex);
                                    if (cached == void 0)
                                        return;
                                    pause(cached);
                                }
                                boombox.onFocus = function () {
                                    var cached = boombox.get('story_' + playIndex);
                                    if (cached == void 0)
                                        return;
                                    resume(cached);
                                }
                            }
                        } else {
                            $('a.voicePlay').css('visibility', 'visible');
                            $('a.voicePlay img').attr('src', '../../idolmaster/image_sp/ui/episode/epi_button_voice_off.jpg');
                            $('a.voicePlay').click(function () {
                                return false;
                            });
                        }
                        
                        function voiceReady(key, url) {
                            playing = true;
                            var option = {
                                "src": [{
                                        "media": "audio/mp4",
                                        "path": url
                                    }
                                ]
                            };
                            boombox.load('story_' + key, option, htc, function (err, htmlvideo) {
                                if (htc) {
                                    $(htmlvideo.$el).css({
                                        top: '-1000px',
                                        left: '0px',
                                        position: 'absolute'
                                    });
                                    $('body').append(htmlvideo.$el);
                                }
                                var cached = boombox.get('story_' + key);
                                if (ios) {
                                    $('a.voicePlay img').attr('src', '../../idolmaster/image_sp/ui/episode/epi_button_voice_open.jpg');
                                    window.ready = true;
                                } else {
                                    $('a.voicePlay img').attr('src', '../../idolmaster/image_sp/ui/episode/epi_button_voice_playing.jpg');
                                    cached.play();
                                }
                                if (!ios && cached.buffer != void 0) {
                                    timer = setTimeout(function () {
                                        playEnded();
                                    }, Math.ceil(cached.buffer.duration * 1000));
                                } else {
                                    cached.onEnded = function () {
                                        playEnded();
                                    }
                                }
                            });
                        }
                        
                        function playEnded() {
                            $('a.voicePlay img').attr('src', '../../idolmaster/image_sp/ui/episode/epi_button_voice_open.jpg');
                            if (voiceDataAry.length > playIndex + 1) {
                                playIndex++;
                            }
                            playing = false;
                        }
                        
                        function pause(cach) {
                            if (!ios && cach.buffer != void 0)
                                clearTimeout(timer);
                            $('a.voicePlay img').attr('src', '../../idolmaster/image_sp/ui/episode/epi_button_voice_open.jpg');
                            cach.pause();
                        }
                        
                        function resume(cach) {
                            var delay = Math.ceil(cach.buffer.duration * 1000) - cach.state.time.pause;
                            $('a.voicePlay img').attr('src', '../../idolmaster/image_sp/ui/episode/epi_button_voice_playing.jpg');
                            cach.resume();
                            if (ios || cach.buffer == void 0)
                                return;
                            clearTimeout(timer);
                            timer = setTimeout(function () {
                                playEnded();
                            }, delay);
                        }
                    });
                </script>
                <footer>
                    <div class="line_idolmaster"></div>
                    <a href="#top" id="toPageTop" class="mypage_under">
                        <div></div>
                    </a>
                    <div class="t-Cnt">©T.K. THE IDOLM@STER™ &amp; ©BNEI</div>
                </footer>
            </div>
        </div>
    </body>
</html>
